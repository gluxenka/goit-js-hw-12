{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst searchKey = '47095841-45755c038ed861ac306bdd605';\nconst defaultImageType = 'photo';\nconst defaultOrientation = 'horizontal';\nconst enableSafeSearch = true;\nexport const defaultPerPage = 15;\nconst API_PICTURES_LIMIT = 500;\n\nconst baseApiUrl = `https://pixabay.com/api/`;\n\nexport async function getPictures(query, pageNumber) {\n  const isMoreThenLimit = API_PICTURES_LIMIT < pageNumber * defaultPerPage;\n\n  let perPage = defaultPerPage;\n\n  if (isMoreThenLimit) {\n    const fullPageCount = Math.floor(API_PICTURES_LIMIT / defaultPerPage);\n\n    const outOfFullPageElementsCount =\n      API_PICTURES_LIMIT - fullPageCount * defaultPerPage;\n    if (outOfFullPageElementsCount > 0 && pageNumber === fullPageCount + 1) {\n      // request last possible page\n      perPage = outOfFullPageElementsCount;\n      pageNumber = API_PICTURES_LIMIT / perPage;\n    }\n  }\n\n  const search = getSearchParams(query, pageNumber, perPage).toString();\n  const url = `${baseApiUrl}?${search}`;\n  const response = await axios.get(url);\n  return response.data;\n}\n\nfunction getSearchParams(query, pageNumber, perPage) {\n  return new URLSearchParams({\n    q: query,\n    key: searchKey,\n    page: pageNumber,\n    image_type: defaultImageType,\n    orientation: defaultOrientation,\n    per_page: perPage,\n    safesearch: enableSafeSearch,\n  });\n}\n","import { defaultPerPage } from './pixabay-api.js';\n\nconst galleryContainer = document.querySelector('.gallery');\n\nconst imageDetails = [\n  { label: 'Likes', field: 'likes' },\n  { label: 'Views', field: 'views' },\n  { label: 'Comments', field: 'comments' },\n  { label: 'Downloads', field: 'downloads' },\n];\n\nexport function switchVisibility(element, show) {\n  if (show) {\n    element.classList.remove('hidden');\n  } else {\n    element.classList.add('hidden');\n  }\n}\n\nexport function clearGallery() {\n  galleryContainer.innerHTML = '';\n  switchVisibility(galleryContainer, false);\n}\n\nexport function scrollToPageStart(page) {\n  const firstPageItem = galleryContainer.children.item(\n    defaultPerPage * (page - 1)\n  );\n\n  firstPageItem?.scrollIntoView({\n    inline: 'start',\n    behavior: 'smooth',\n  });\n}\n\nexport function addGalleryItems(pictureItems) {\n  const tempContainer = document.createElement('div');\n  tempContainer.innerHTML = pictureItems.map(renderPictureItem).join('');\n  const elements = Array.from(tempContainer.children);\n\n  if (elements.length > 0) {\n    switchVisibility(galleryContainer, true);\n    galleryContainer.append(...Array.from(tempContainer.children));\n  }\n}\n\nfunction renderPictureItem(pictureItem) {\n  const previewUrl = pictureItem.previewURL;\n  const largeImageURL = pictureItem.largeImageURL;\n  const alt = pictureItem.tags;\n  return `\n    <a class=\"gallery-item\" href=\"${largeImageURL}\">\n\n\n    <img class=\"gallery-item-image\" alt=\"${alt}\" src=\"${previewUrl}\"/>\n    <div class=\"gallery-item-details-container\">\n      ${imageDetails.map(imgDetail => renderDetailsElement(imgDetail.label, pictureItem[imgDetail.field])).join('')}\n    </div>\n\n    </a>`;\n}\n\nfunction renderDetailsElement(label, value) {\n  return `\n    <div class=\"gallery-item-details-element\">\n      <span class=\"label\">${label}</span>\n      <span class=\"value\">${value}</span>\n    </div>`;\n}\n","import 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport { getPictures } from './js/pixabay-api.js';\nimport {\n  addGalleryItems,\n  clearGallery,\n  scrollToPageStart,\n  switchVisibility,\n} from './js/render-functions.js';\n\nconst searchForm = document.getElementById('search-form');\nconst searchInput = document.getElementById('search-input');\nconst loadMoreButton = document.getElementById('load-more');\nconst loader = document.querySelector('.loader');\n\nconst galleryViewer = new SimpleLightbox('.gallery-item', {\n  captionsData: 'alt',\n  captionDelay: 250,\n  fadeSpeed: 1000,\n});\n\nconst DEFAULT_PAGE = 30;\nconst DEFAULT_LOADED_PICTURES_COUNT = 0;\nlet currentLoadedPicturesCount = DEFAULT_LOADED_PICTURES_COUNT;\nlet currentPage = DEFAULT_PAGE;\nlet currentQuery = '';\n\nasync function triggerSearch(query, page, shouldClear) {\n  switchVisibility(loader, true);\n\n  if (shouldClear) {\n    clearGallery();\n  }\n\n  try {\n    const result = await getPictures(query, page);\n    const { hits: pictures, totalHits } = result;\n    switchVisibility(loader, false);\n    addGalleryItems(pictures);\n    currentPage = page;\n    currentQuery = query;\n    if (currentPage === 1) {\n      currentLoadedPicturesCount = DEFAULT_LOADED_PICTURES_COUNT;\n    }\n    currentLoadedPicturesCount += pictures.length;\n\n    galleryViewer.refresh();\n    const isEndOfList = currentLoadedPicturesCount >= totalHits;\n    const isEmptyList = pictures.length === 0;\n\n    if (!isEmptyList && isEndOfList) {\n      showEndOfListToast();\n      switchVisibility(loadMoreButton, false);\n    }\n\n    if (isEmptyList) {\n      showNotFoundToast();\n    }\n\n    if (!isEmptyList && !isEndOfList) {\n      switchVisibility(loadMoreButton, true);\n    }\n\n    if (!isEmptyList) {\n      scrollToPageStart(currentPage);\n    }\n  } catch (e) {\n    switchVisibility(loader, false);\n    showRequestFailedToast();\n  }\n}\n\nfunction showNotFoundToast() {\n  iziToast.error({\n    message:\n      'Sorry, there are no images matching your search query. Please try again!',\n    position: 'topRight',\n    iconColor: '#FFF',\n    titleColor: '#FFF',\n    messageColor: '#FFF',\n    backgroundColor: '#EF4040',\n    progressBarColor: '#B51B1B',\n  });\n}\n\nfunction showEndOfListToast() {\n  iziToast.info({\n    message: \"We're sorry, but you've reached the end of search results.\",\n    position: 'topRight',\n    iconColor: '#FFF',\n    titleColor: '#FFF',\n    messageColor: '#FFF',\n    backgroundColor: '#0099FF',\n    progressBarColor: '#0071BD',\n  });\n}\n\nfunction showRequestFailedToast() {\n  iziToast.error({\n    message: `Request failed, please try again later`,\n    position: 'topRight',\n    iconColor: '#FFF',\n    titleColor: '#FFF',\n    messageColor: '#FFF',\n    backgroundColor: '#EF4040',\n    progressBarColor: '#B51B1B',\n  });\n}\n\nfunction syncInput(value) {\n  searchInput.value = value;\n}\n\nfunction handleSearchSubmit(event) {\n  event.preventDefault();\n  const formData = new FormData(searchForm);\n  const formValues = Object.fromEntries(formData);\n  let query = formValues.query?.trim?.() ?? '';\n\n  syncInput(query);\n\n  if (!query) {\n    return;\n  }\n\n  switchVisibility(loadMoreButton, false);\n  triggerSearch(query, DEFAULT_PAGE, true);\n}\n\nfunction loadMore() {\n  syncInput(currentQuery);\n  switchVisibility(loadMoreButton, false);\n  triggerSearch(currentQuery, currentPage + 1, false);\n}\n\nfunction init() {\n  searchForm.addEventListener('submit', handleSearchSubmit);\n  loadMoreButton.addEventListener('click', loadMore);\n}\n\ninit();\n"],"names":["searchKey","defaultImageType","defaultOrientation","enableSafeSearch","defaultPerPage","API_PICTURES_LIMIT","baseApiUrl","getPictures","query","pageNumber","isMoreThenLimit","perPage","fullPageCount","outOfFullPageElementsCount","search","getSearchParams","url","axios","galleryContainer","imageDetails","switchVisibility","element","show","clearGallery","scrollToPageStart","page","firstPageItem","addGalleryItems","pictureItems","tempContainer","renderPictureItem","pictureItem","previewUrl","largeImageURL","alt","imgDetail","renderDetailsElement","label","value","searchForm","searchInput","loadMoreButton","loader","galleryViewer","SimpleLightbox","DEFAULT_PAGE","DEFAULT_LOADED_PICTURES_COUNT","currentLoadedPicturesCount","currentPage","currentQuery","triggerSearch","shouldClear","result","pictures","totalHits","isEndOfList","isEmptyList","showEndOfListToast","showNotFoundToast","showRequestFailedToast","iziToast","syncInput","handleSearchSubmit","event","formData","_b","_a","loadMore","init"],"mappings":"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"}